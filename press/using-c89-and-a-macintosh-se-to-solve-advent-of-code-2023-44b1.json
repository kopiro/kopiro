{
  "type_of": "article",
  "id": 1686606,
  "title": "Using C89 on a '80s Macintosh SE to solve Advent of Code 2023",
  "description": "For this year AdventOfCode, I want to try to solve some problems using an old Macintosh SE I have...",
  "readable_publish_date": "Dec 3 '23",
  "slug": "using-c89-and-a-macintosh-se-to-solve-advent-of-code-2023-44b1",
  "path": "/kopiro/using-c89-and-a-macintosh-se-to-solve-advent-of-code-2023-44b1",
  "url": "https://dev.to/kopiro/using-c89-and-a-macintosh-se-to-solve-advent-of-code-2023-44b1",
  "comments_count": 0,
  "public_reactions_count": 0,
  "collection_id": null,
  "published_timestamp": "2023-12-03T13:50:30Z",
  "language": "en",
  "subforem_id": null,
  "positive_reactions_count": 0,
  "cover_image": "https://media2.dev.to/dynamic/image/width=1000,height=420,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F5tqxlid54aj7vp5mvwqp.jpeg",
  "social_image": "https://media2.dev.to/dynamic/image/width=1000,height=500,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F5tqxlid54aj7vp5mvwqp.jpeg",
  "canonical_url": "https://dev.to/kopiro/using-c89-and-a-macintosh-se-to-solve-advent-of-code-2023-44b1",
  "created_at": "2023-12-03T13:50:30Z",
  "edited_at": "2023-12-04T10:25:38Z",
  "crossposted_at": null,
  "published_at": "2023-12-03T13:50:30Z",
  "last_comment_at": "2023-12-03T13:50:30Z",
  "reading_time_minutes": 2,
  "tag_list": "",
  "tags": [],
  "body_html": "<p>For this year <a href=\"https://adventofcode.com/\" target=\"_blank\" rel=\"noopener noreferrer\">AdventOfCode</a>, I want to try to solve some problems using an old Macintosh SE I have lying around and the ThinkC compiler.</p>\n\n<p>My goal is to learn more about the old C89 syntax and also try to get as efficient as possible with memory and CPU so that even more complex problems can be solved in reasonable time.</p>\n\n<h3>\n  <a name=\"day-0\" href=\"#day-0\">\n  </a>\n  Day 0\n</h3>\n\n<p>First of all, I had to resurrect the old Macintosh and make sure everything works correctly. With my surprise, the <a href=\"https://beyondloom.com/blog/thinkc.html\" target=\"_blank\" rel=\"noopener noreferrer\">ThinkC compiler</a> was already installed from 3 years ago and I managed to run a very quick \"Hello world\".</p>\n\n<p>The IDE that comes with the ThinkC compiler, called ThinkC Project manager, it's surprisingly good for those years.</p>\n\n<p>Then, I had to make sure I could still use my 1.4MB floppy disks with a modern MacBook. The TLDR is that old Macintoshs use HFS file systems and the support for this has been removed, therefore you can't just mount the floppy and see the files in the Finder of your new macOS Sonoma.</p>\n\n<p>After playing a bit with macFUSE and <em>not</em> get anything working, I managed to simply mount the disk and copy the files using <code>hfsutils</code>:<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight plaintext\"><code>brew install hfsutils\n\n# Mount the floppy\nsudo hmount /dev/disk6\n\n# Copy the input data\nsudo hcopy -a ~/Developer/aoc/2023/1/input.txt :1.txt\n\n# Copy the source from the Macintosh\nsudo hcopy -a :1.c ~/Developer/aoc/2023/1/main.c\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>I strangely could't open the input.txt on the Macintosh itself, but the C program I wrote is able to read the file correctly using <code>fopen</code></p>\n\n<h3>\n  <a name=\"day-1-learnings\" href=\"#day-1-learnings\">\n  </a>\n  Day 1 learnings\n</h3>\n\n<h4>\n  <a name=\"declarations-at-the-beginning-of-the-scope\" href=\"#declarations-at-the-beginning-of-the-scope\">\n  </a>\n  Declarations at the beginning of the scope\n</h4>\n\n<p>ANSI C89 requires variables to be declared at the beginning of a scope; this is not valid (syntax error on line 3):<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight c\"><code><span class=\"kt\">FILE</span><span class=\"o\">*</span> <span class=\"n\">fp</span> <span class=\"o\">=</span> <span class=\"n\">fopen</span><span class=\"p\">(</span><span class=\"s\">\"example.txt\"</span><span class=\"p\">,</span> <span class=\"s\">\"r\"</span><span class=\"p\">);</span>\n<span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">fp</span> <span class=\"o\">==</span> <span class=\"nb\">NULL</span><span class=\"p\">)</span> <span class=\"k\">return</span><span class=\"p\">;</span>\n<span class=\"kt\">char</span> <span class=\"n\">line</span><span class=\"p\">[</span><span class=\"mi\">128</span><span class=\"p\">];</span>\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h4>\n  <a name=\"snprintf-doesnt-exist\" href=\"#snprintf-doesnt-exist\">\n  </a>\n  snprintf doesn't exist\n</h4>\n\n<p>The safer version of <a href=\"https://cplusplus.com/reference/cstdio/snprintf/\" target=\"_blank\" rel=\"noopener noreferrer\">sprintf</a> to do string concatenation doesn't exists; no big deal, I don't really care about safety in this scenario.</p>\n\n<h4>\n  <a name=\"i-hit-32k-limit-with-raw-int-sum-endraw-\" href=\"#i-hit-32k-limit-with-raw-int-sum-endraw-\">\n  </a>\n  I hit 32k limit with <code>int sum</code>\n</h4>\n\n<p>My <code>int sum</code> went negative as soon I hit the number 32k. </p>\n\n<p>I thought that this CPU was 32bit, but something it telling me that it's rather 16bit.</p>\n\n<p>Switching to <code>unsigned long</code> and also making sure I use <code>printf(\"%lu\", sum)</code> (took 20m to realize I was still using <code>%d</code>) made it work.</p>\n\n",
  "body_markdown": "For this year [AdventOfCode](https://adventofcode.com/), I want to try to solve some problems using an old Macintosh SE I have lying around and the ThinkC compiler.\n\nMy goal is to learn more about the old C89 syntax and also try to get as efficient as possible with memory and CPU so that even more complex problems can be solved in reasonable time.\n\n### Day 0\n\nFirst of all, I had to resurrect the old Macintosh and make sure everything works correctly. With my surprise, the [ThinkC compiler](https://beyondloom.com/blog/thinkc.html) was already installed from 3 years ago and I managed to run a very quick \"Hello world\".\n\nThe IDE that comes with the ThinkC compiler, called ThinkC Project manager, it's surprisingly good for those years.\n\nThen, I had to make sure I could still use my 1.4MB floppy disks with a modern MacBook. The TLDR is that old Macintoshs use HFS file systems and the support for this has been removed, therefore you can't just mount the floppy and see the files in the Finder of your new macOS Sonoma.\n\nAfter playing a bit with macFUSE and *not* get anything working, I managed to simply mount the disk and copy the files using `hfsutils`:\n\n```\nbrew install hfsutils\n\n# Mount the floppy\nsudo hmount /dev/disk6\n\n# Copy the input data\nsudo hcopy -a ~/Developer/aoc/2023/1/input.txt :1.txt\n\n# Copy the source from the Macintosh\nsudo hcopy -a :1.c ~/Developer/aoc/2023/1/main.c\n```\n\nI strangely could't open the input.txt on the Macintosh itself, but the C program I wrote is able to read the file correctly using `fopen`\n\n### Day 1 learnings\n\n#### Declarations at the beginning of the scope\n\nANSI C89 requires variables to be declared at the beginning of a scope; this is not valid (syntax error on line 3):\n\n```c\nFILE* fp = fopen(\"example.txt\", \"r\");\nif (fp == NULL) return;\nchar line[128];\n```\n\n#### snprintf doesn't exist\n\nThe safer version of [sprintf](https://cplusplus.com/reference/cstdio/snprintf/) to do string concatenation doesn't exists; no big deal, I don't really care about safety in this scenario.\n\n#### I hit 32k limit with `int sum`\n\nMy `int sum` went negative as soon I hit the number 32k. \n\nI thought that this CPU was 32bit, but something it telling me that it's rather 16bit.\n\nSwitching to `unsigned long` and also making sure I use `printf(\"%lu\", sum)` (took 20m to realize I was still using `%d`) made it work.\n\n",
  "user": {
    "name": "Flavio De Stefano",
    "username": "kopiro",
    "twitter_username": "destefanoflavio",
    "github_username": "kopiro",
    "user_id": 386888,
    "website_url": "https://www.kopiro.me",
    "profile_image": "https://media2.dev.to/dynamic/image/width=640,height=640,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Fuser%2Fprofile_image%2F386888%2Ff683c0ad-bdf7-4401-9141-46416239d66d.jpg",
    "profile_image_90": "https://media2.dev.to/dynamic/image/width=90,height=90,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Fuser%2Fprofile_image%2F386888%2Ff683c0ad-bdf7-4401-9141-46416239d66d.jpg"
  }
}