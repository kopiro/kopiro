{
  "type_of": "article",
  "id": 413677,
  "title": "How to install Kali on a USB stick with pure EFI boot on a Mac (and with virtualization via USB on Virtualbox)",
  "description": "This tutorial is for everyone who wants a USB stick with a full Kali installation to use with your Ma...",
  "readable_publish_date": "Jul 30 '20",
  "slug": "how-to-install-kali-on-a-usb-stick-with-pure-efi-boot-on-a-mac-and-with-virtualization-via-usb-on-virtualbox-2md2",
  "path": "/kopiro/how-to-install-kali-on-a-usb-stick-with-pure-efi-boot-on-a-mac-and-with-virtualization-via-usb-on-virtualbox-2md2",
  "url": "https://dev.to/kopiro/how-to-install-kali-on-a-usb-stick-with-pure-efi-boot-on-a-mac-and-with-virtualization-via-usb-on-virtualbox-2md2",
  "comments_count": 0,
  "public_reactions_count": 1,
  "collection_id": null,
  "published_timestamp": "2020-07-30T10:24:16Z",
  "language": "en",
  "subforem_id": null,
  "positive_reactions_count": 1,
  "cover_image": null,
  "social_image": "https://media2.dev.to/dynamic/image/width=1000,height=500,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fsxkramn7aof3810488ke.png",
  "canonical_url": "https://dev.to/kopiro/how-to-install-kali-on-a-usb-stick-with-pure-efi-boot-on-a-mac-and-with-virtualization-via-usb-on-virtualbox-2md2",
  "created_at": "2020-07-30T10:23:58Z",
  "edited_at": "2020-07-30T10:24:58Z",
  "crossposted_at": null,
  "published_at": "2020-07-30T10:24:16Z",
  "last_comment_at": "2020-07-30T10:24:16Z",
  "reading_time_minutes": 6,
  "tag_list": "",
  "tags": [],
  "body_html": "<p>This tutorial is for everyone who wants a USB stick with a <strong>full Kali installation</strong> to use with your Mac(s). This is not intended to perform a Live Kali installation with persistence.</p>\n\n<p><strong>The problem when you perform a Kali installation on a USB stick is that Kali partitions the disk with the VFAT file system. Mac OS only recognizes HFS+ partitions along with some files needed for it.</strong></p>\n\n<p>So, you need:</p>\n\n<ul>\n<li><p>Your Mac</p></li>\n<li><p>A USB stick with Kali ISO installer</p></li>\n<li><p>A target USB stick, SD card or an SSD external drive where you’re going to install Kali (16GB and USB 3.0 recommended)</p></li>\n</ul>\n\n<p><em>This tutorial was heavily inspired by this tutorial with proper fixes for Kali. <a href=\"https://medium.com/@mmiglier/ubuntu-installation-on-usb-stick-with-pure-efi-boot-mac-compatible-469ad33645c9\" target=\"_blank\" rel=\"noopener noreferrer\">https://medium.com/@mmiglier/ubuntu-installation-on-usb-stick-with-pure-efi-boot-mac-compatible-469ad33645c9</a></em></p>\n\n<h3>\n  <a name=\"usb-live-installation\" href=\"#usb-live-installation\">\n  </a>\n  USB Live installation\n</h3>\n\n<p>First of all, install Kali on a USB stick by following this <a href=\"https://docs.kali.org/downloading/kali-linux-live-usb-install\" target=\"_blank\" rel=\"noopener noreferrer\">tutorial</a>. I’m not gonna bother you on how to proceed on this step, but start here:<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code><span class=\"nb\">sudo dd </span><span class=\"k\">if</span><span class=\"o\">={</span>KALI_ISO.iso<span class=\"o\">}</span> <span class=\"nv\">of</span><span class=\"o\">=</span>/dev/<span class=\"o\">{</span>USB<span class=\"o\">}</span> <span class=\"nv\">bs</span><span class=\"o\">=</span>1m \n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>When you’re ready, reboot your Mac. Insert both your USB sticks, then press ALT and select the <strong>EFI boot</strong> to start the Live installer.</p>\n\n<p><a href=\"https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fd8gw8f6b5xspeornsk7b.png\" class=\"article-body-image-wrapper\"><img src=\"https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fd8gw8f6b5xspeornsk7b.png\" loading=\"lazy\" width=\"347\" height=\"242\"></a></p>\n\n<p>Kali installer will ask you different questions about your timezone and keyboard layout.</p>\n\n<p>Proceed until it asks you to partition disks, here select: <strong>Manual.</strong> Then select your USB <strong>target</strong> drive (where you want to install Kali). You can recognize by various factors, for example by its size. Click <strong>Continue:</strong> this will partition your drive.</p>\n\n<p>Now, back again to the same screen and select the <strong>FREE SPACE</strong> under the USB target drive. Click <strong>Continue</strong> and select Automatically partition the free space. Follow the recommended option. Then click on Finish partitioning and write the change to disk.</p>\n\n<p>The installation process now will copy data to disk. Wait until it finishes (this is gonna take ~30 minutes).</p>\n\n<h3>\n  <a name=\"boot-from-grub-live\" href=\"#boot-from-grub-live\">\n  </a>\n  Boot from GRUB Live\n</h3>\n\n<p>Once finished, your Mac will reboot and you have to press <strong>ALT</strong> again. Select <strong>EFI boot</strong> again.</p>\n\n<p>What we have to do now is to load our installed Kali system via <strong>Live GRUB</strong>, because our installed system doesn’t have a recognizable boot-loader by MacOS.</p>\n\n<p>Once GRUB is loaded, press <strong>c</strong> to get the GRUB command-line-interface.</p>\n\n<p>Now you have to understand in which HD is your Kali installation. To do this, when GRUB CLI is loaded, type <code>ls</code>; eject your USB stick and type <code>ls</code> gain.<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>grub&gt; <span class=\"nb\">ls</span>\n<span class=\"o\">(</span>memdisk<span class=\"o\">)</span> <span class=\"o\">(</span>hd0<span class=\"o\">)</span> <span class=\"o\">(</span>hd1<span class=\"o\">)</span> <span class=\"o\">(</span>hd1,gpt3<span class=\"o\">)</span> <span class=\"o\">(</span>hd1, gpt2<span class=\"o\">)</span> <span class=\"o\">(</span>hd1,gpt1<span class=\"o\">)</span> ...\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>You’ll notice that an <code>hd{X}</code> disappeared: that is your drive. Now you have to find your <code>gpt</code>. Probably it’s the <code>gpt2</code> but just to be sure, type:<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>grub&gt; <span class=\"nb\">ls</span> <span class=\"o\">(</span>hdX,gpt2<span class=\"o\">)</span>/boot/grub\nunicode.pf2 ...\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><em>If the command says <code>unicode..</code> it’s the correct gpt; try other **gpts</em>* otherwise. Now find your UUID of the partition, and annotate it.<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>grub&gt; <span class=\"nb\">ls</span> <span class=\"nt\">-l</span> <span class=\"o\">(</span>hdX<span class=\"o\">}</span>,gpt<span class=\"o\">{</span>X<span class=\"o\">})</span>\nPartition hd2,gpt2: Filesystem <span class=\"nb\">type </span>ext<span class=\"k\">*</span> 〈...snip...〉 UUID <span class=\"k\">**</span>e86c20b9-83e1-447d-a3be-d1ddaad6c4c6<span class=\"k\">**</span> - Partition start at <span class=\"o\">[</span>...]\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Now we can set the parameters to GRUB to boot (use the <strong>tab</strong> key to use autocomplete):<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>grub&gt; <span class=\"nb\">set </span><span class=\"nv\">root</span><span class=\"o\">=(</span>hd<span class=\"o\">{</span>X<span class=\"o\">}</span>,gpt<span class=\"o\">{</span>X<span class=\"o\">})</span>\ngrub&gt; linux /boot/vmlinuz〈...tab here!...〉.efi.signed <span class=\"nv\">root</span><span class=\"o\">=</span><span class=\"nv\">UUID</span><span class=\"o\">=</span>〈the UUID〉\ngrub&gt; initrd /boot/initrd〈...tab here!...〉\ngrub&gt; boot\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>This should boot your <strong>Full Kali Installation</strong> using the Live GRUB. You could differentiate from the Live environment by the password it recognizes during the login process.</p>\n\n<h3>\n  <a name=\"fixing-the-efi-partition\" href=\"#fixing-the-efi-partition\">\n  </a>\n  Fixing the EFI partition\n</h3>\n\n<p>Once you’re logged in in your Kali installation, open the Terminal and type:<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>fdisk <span class=\"nt\">-l</span>\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>and find your drive.</p>\n\n<p>Now, open <strong>gdisk</strong> (installed by default on Kali) to partition the drive (be very careful here):<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code><span class=\"nv\">$ </span>gdisk /dev/sd<span class=\"o\">{</span>X<span class=\"o\">}</span>\nGPT fdisk <span class=\"o\">(</span>gdisk<span class=\"o\">)</span> version 1.0.1\n\nPartition table scan:\n  MBR: hybrid\n  BSD: not present\n  APM: not present\n  GPT: present\n\nFound valid GPT with hybrid MBR<span class=\"p\">;</span> using GPT.\n\nCommand <span class=\"o\">(</span>? <span class=\"k\">for </span><span class=\"nb\">help</span><span class=\"o\">)</span>:\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Now we have to:</p>\n\n<ul>\n<li><p>delete that EF00 partition</p></li>\n<li><p>create a new HFS+ once in its place<br>\n</p></li>\n</ul>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>Command <span class=\"o\">(</span>? <span class=\"k\">for </span><span class=\"nb\">help</span><span class=\"o\">)</span>: p\nDisk /dev/sdd: ...\n\n<span class=\"o\">[</span>...]\n\nNumber  Start <span class=\"o\">(</span>sector<span class=\"o\">)</span>  End <span class=\"o\">(</span>sector<span class=\"o\">)</span>  Size     Code   Name\n   1         2048         1050623  512.0 MiB   EF00   EFI System Partition\n\n<span class=\"o\">[</span>...]\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><em>Just leave defaults values in the sector phase</em><br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>Current <span class=\"nb\">type </span>is <span class=\"s1\">'Linux filesystem'</span>\nHex code or GUID <span class=\"o\">(</span>L to show codes, Enter <span class=\"o\">=</span> 8300<span class=\"o\">)</span>: AF00\nChanged <span class=\"nb\">type </span>of partition to <span class=\"s1\">'Apple HFS/HFS+'</span>\n\nCommand <span class=\"o\">(</span>? <span class=\"k\">for </span><span class=\"nb\">help</span><span class=\"o\">)</span>: w\n\nFinal checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING PARTITIONS!!\n\nDo you want to proceed? <span class=\"o\">(</span>Y/N<span class=\"o\">)</span>: Y\n\nOK<span class=\"p\">;</span> writing new GUID partition table <span class=\"o\">(</span>GPT<span class=\"o\">)</span> to /dev/sdd.\nWarning: The kernel is still using the old partition table.\nThe new table will be used at the next reboot.\nThe operation has completed successfully.\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Now we have an unformatted HFS+ partition. To format, we need some tools; but to obtain these tools we need to add the Debian source-list to <strong>apt</strong>.<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code><span class=\"nb\">echo</span> <span class=\"s2\">\"deb http://ftp.debian.org/debian unstable main contrib non-free\"</span> <span class=\"o\">&gt;</span> /etc/apt/sources.list.d/debian.list <span class=\"o\">&amp;&amp;</span> <span class=\"se\">\\</span>\napt update <span class=\"o\">&amp;&amp;</span> <span class=\"se\">\\</span>\napt <span class=\"nb\">install </span>hfsprogs\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>We can format that partition:<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>mkfs.hfsplus /dev/sd<span class=\"o\">{</span>X<span class=\"o\">}</span>1 <span class=\"nt\">-v</span> Kali\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Now we have to edit the <strong>/etc/fstab</strong> file:<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>gedit /etc/fstab\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>This will launch Gedit. In this file, localize these lines:<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight plaintext\"><code># /boot/efi was on /dev/sd{X}1 during installation\nUUID={XXXXXXX} /boot/efi vfat defaults 0 1\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>and delete them.</p>\n\n<p>Now, unmount the boot partition, localizing it using:<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>mount | <span class=\"nb\">grep</span> /boot/efi\numount /dev/sd<span class=\"o\">{</span>Y<span class=\"o\">}</span>1\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Then run this to add the necessary entries to your fstab file:<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code><span class=\"nb\">echo</span> <span class=\"s2\">\"UUID=</span><span class=\"si\">$(</span>blkid <span class=\"nt\">-o</span> value <span class=\"nt\">-s</span> UUID /dev/sd<span class=\"o\">{</span>X<span class=\"o\">}</span>1<span class=\"si\">)</span><span class=\"s2\"> /boot/efi auto defaults 0 0\"</span> <span class=\"o\">&gt;&gt;</span> /etc/fstab\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Now we have to reinstall GRUB so it can use the newly formatted HFS+ partition for its EFI data:<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code><span class=\"nb\">mkdir</span> <span class=\"nt\">-p</span> /boot/efi/EFI/Kali\n<span class=\"nb\">echo</span> <span class=\"s2\">\"This file is required for booting\"</span> <span class=\"o\">&gt;</span> /boot/efi/EFI/Kali/mach_kernel\n<span class=\"nb\">echo</span> <span class=\"s2\">\"This file is required for booting\"</span> <span class=\"o\">&gt;</span> /boot/efi/mach_kernel\ngrub-install <span class=\"nt\">--target</span> x86_64-efi <span class=\"nt\">--boot-directory</span><span class=\"o\">=</span>/boot <span class=\"nt\">--efi-directory</span><span class=\"o\">=</span>/boot/efi <span class=\"nt\">--bootloader-id</span><span class=\"o\">=</span>Kali\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>We then need to “bless” the bootloader code, so that the Mac bootloader will boot it. To do that we need <strong>hfsbless</strong> binary that is not available via apt. No problem, just clone the repository and build:<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code><span class=\"nb\">cd</span> /root\ngit clone https://github.com/detly/mactel-boot\n<span class=\"nb\">cd </span>mactel-boot\nmake\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Then bless:<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>./hfs-bless /boot/efi/EFI/Kali/System/Library/CoreServices/boot.efi\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>The final step is to create the grub configuration:<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code><span class=\"nb\">sed</span> <span class=\"nt\">-i</span> <span class=\"s1\">'s/GRUB_HIDDEN/#GRUB_HIDDEN/g'</span> /etc/default/grub\n<span class=\"nb\">sed</span> <span class=\"nt\">-i</span> <span class=\"s1\">'s/GRUB_TIMEOUT=10/GRUB_TIMEOUT=0.1/'</span> /etc/default/grub\ngrub-mkconfig <span class=\"nt\">-o</span> /boot/grub/grub.cfg\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Perfecto! Now reboot and you should see your USB stick in the Mac bootloader by pressing <strong>ALT</strong>.</p>\n\n<h3>\n  <a name=\"virtualizing-the-usb-via-virtualbox\" href=\"#virtualizing-the-usb-via-virtualbox\">\n  </a>\n  Virtualizing the USB via Virtualbox\n</h3>\n\n<p>If you ever need to boot this USB stick via Virtualbox (on Mac OSX), there is a simple trick to do that.</p>\n\n<p>First of all, you’ve to create a VMDK disk that points to the sectors of your USB stick. So, let’s identify that disk:<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight plaintext\"><code>diskutil list\n    /dev/disk0 (internal):\n       #:                       TYPE NAME                    SIZE       IDENTIFIER\n       0:      GUID_partition_scheme                         500.3 GB   disk0\n       1:                        EFI EFI                     314.6 MB   disk0s1\n       2:                 Apple_APFS Container disk1         499.3 GB   disk0s2\n\n    /dev/disk1 (synthesized):\n       #:                       TYPE NAME                    SIZE       IDENTIFIER\n       0:      APFS Container Scheme -                      +499.3 GB   disk1\n                                     Physical Store disk0s2\n       1:                APFS Volume Macintosh HD            222.0 GB   disk1s1\n       2:                APFS Volume Preboot                 22.4 MB    disk1s2\n       3:                APFS Volume Recovery                519.9 MB   disk1s3\n       4:                APFS Volume VM                      3.2 GB     disk1s4\n\n    /dev/disk3 (external, physical):\n       #:                       TYPE NAME                    SIZE       IDENTIFIER\n       0:      GUID_partition_scheme                        *32.0 GB    disk3\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>In our case, it is **/dev/disk3. **Let’s unmount before proceeding:<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>diskutil unmountDisk /dev/disk<span class=\"o\">{</span>X<span class=\"o\">}</span>\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>With VirtualBox installed, run:<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code><span class=\"nb\">sudo </span>VBoxManage internalcommands createrawvmdk <span class=\"nt\">-filename</span> ~/Kali.vmdk <span class=\"nt\">-rawdisk</span> /dev/disk<span class=\"o\">{</span>X<span class=\"o\">}</span>\n<span class=\"nb\">chmod </span>777 ~/Kali.vmdk\n<span class=\"nb\">chmod </span>777 /dev/disk<span class=\"o\">{</span>X<span class=\"o\">}</span>\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Perfecto. Now, run Virtualbox UI and create a new machine with the following settings:</p>\n\n<p><a href=\"https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fw76xwgnu5524iocjt8zf.png\" class=\"article-body-image-wrapper\"><img src=\"https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fw76xwgnu5524iocjt8zf.png\" loading=\"lazy\" width=\"691\" height=\"480\"></a></p>\n\n<p>When VirtualBox asks you for a disk, let’s point to that VMDK created before:</p>\n\n<p><a href=\"https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F6fqyralbbt4nxu083uyj.png\" class=\"article-body-image-wrapper\"><img src=\"https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F6fqyralbbt4nxu083uyj.png\" loading=\"lazy\" width=\"691\" height=\"480\"></a></p>\n\n<p>Before starting up the machine, let’s go to Settings and adjust your process counts, video and memory.</p>\n\n<p>The important things are to set <strong>Enable EFI **under **System &gt; Motherboard.</strong></p>\n\n<p><a href=\"https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fi3z56j6gzvi1h5qc97p2.png\" class=\"article-body-image-wrapper\"><img src=\"https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fi3z56j6gzvi1h5qc97p2.png\" loading=\"lazy\" width=\"389\" height=\"91\"></a></p>\n\n<p>This will allow you to boot via EFI. Now start the virtual machine and immediately press <strong>F12</strong>.</p>\n\n<p>Select <strong>Boot Maintenance Manager:</strong></p>\n\n<p><a href=\"https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fd47p0ibzwl1wq73ykbzv.png\" class=\"article-body-image-wrapper\"><img src=\"https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fd47p0ibzwl1wq73ykbzv.png\" loading=\"lazy\" width=\"800\" height=\"637\"></a></p>\n\n<p>Select <strong>Boot from file:</strong></p>\n\n<p><a href=\"https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fw34w4xjac3ofqdgmoj50.png\" class=\"article-body-image-wrapper\"><img src=\"https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fw34w4xjac3ofqdgmoj50.png\" loading=\"lazy\" width=\"800\" height=\"637\"></a></p>\n\n<p>Then select {<strong>SATA_DRIVE} &gt; EFI &gt; Kali &gt; System &gt; Library &gt; CoreServices &gt; boot.efi</strong></p>\n\n<p><a href=\"https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Flisiykr1p9ggsf3bnx41.png\" class=\"article-body-image-wrapper\"><img src=\"https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Flisiykr1p9ggsf3bnx41.png\" loading=\"lazy\" width=\"800\" height=\"637\"></a></p>\n\n<p>And, voilà:</p>\n\n<p><a href=\"https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F3qnbthrex8mhb7c8gg55.png\" class=\"article-body-image-wrapper\"><img src=\"https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F3qnbthrex8mhb7c8gg55.png\" loading=\"lazy\" width=\"800\" height=\"633\"></a></p>\n\n<p>Stay tuned :)</p>\n\n",
  "body_markdown": "\nThis tutorial is for everyone who wants a USB stick with a **full Kali installation** to use with your Mac(s). This is not intended to perform a Live Kali installation with persistence.\n\n**The problem when you perform a Kali installation on a USB stick is that Kali partitions the disk with the VFAT file system. Mac OS only recognizes HFS+ partitions along with some files needed for it.**\n\nSo, you need:\n\n* Your Mac\n\n* A USB stick with Kali ISO installer\n\n* A target USB stick, SD card or an SSD external drive where you’re going to install Kali (16GB and USB 3.0 recommended)\n\n*This tutorial was heavily inspired by this tutorial with proper fixes for Kali. [https://medium.com/@mmiglier/ubuntu-installation-on-usb-stick-with-pure-efi-boot-mac-compatible-469ad33645c9](https://medium.com/@mmiglier/ubuntu-installation-on-usb-stick-with-pure-efi-boot-mac-compatible-469ad33645c9)*\n\n### USB Live installation\n\nFirst of all, install Kali on a USB stick by following this [tutorial](https://docs.kali.org/downloading/kali-linux-live-usb-install). I’m not gonna bother you on how to proceed on this step, but start here:\n\n```bash\nsudo dd if={KALI_ISO.iso} of=/dev/{USB} bs=1m \n```\n\nWhen you’re ready, reboot your Mac. Insert both your USB sticks, then press ALT and select the **EFI boot** to start the Live installer.\n\n![](https://cdn-images-1.medium.com/max/2000/0*MzOP02pAieEe6wqE.png)\n\nKali installer will ask you different questions about your timezone and keyboard layout.\n\nProceed until it asks you to partition disks, here select: **Manual.** Then select your USB **target** drive (where you want to install Kali). You can recognize by various factors, for example by its size. Click **Continue:** this will partition your drive.\n\nNow, back again to the same screen and select the **FREE SPACE** under the USB target drive. Click **Continue** and select Automatically partition the free space. Follow the recommended option. Then click on Finish partitioning and write the change to disk.\n\nThe installation process now will copy data to disk. Wait until it finishes (this is gonna take ~30 minutes).\n\n### Boot from GRUB Live\n\nOnce finished, your Mac will reboot and you have to press **ALT** again. Select **EFI boot** again.\n\nWhat we have to do now is to load our installed Kali system via **Live GRUB**, because our installed system doesn’t have a recognizable boot-loader by MacOS.\n\nOnce GRUB is loaded, press **c** to get the GRUB command-line-interface.\n\nNow you have to understand in which HD is your Kali installation. To do this, when GRUB CLI is loaded, type `ls`; eject your USB stick and type `ls` gain.\n\n```bash\ngrub> ls\n(memdisk) (hd0) (hd1) (hd1,gpt3) (hd1, gpt2) (hd1,gpt1) ...\n```\n\nYou’ll notice that an `hd{X}` disappeared: that is your drive. Now you have to find your `gpt`. Probably it’s the `gpt2` but just to be sure, type:\n\n```bash\ngrub> ls (hdX,gpt2)/boot/grub\nunicode.pf2 ...\n```\n\n*If the command says `unicode..` it’s the correct gpt; try other **gpts** otherwise. Now find your UUID of the partition, and annotate it.\n\n```bash\ngrub> ls -l (hdX},gpt{X})\nPartition hd2,gpt2: Filesystem type ext* 〈...snip...〉 UUID **e86c20b9-83e1-447d-a3be-d1ddaad6c4c6** - Partition start at [...]\n```\n\nNow we can set the parameters to GRUB to boot (use the **tab** key to use autocomplete):\n\n```bash\ngrub> set root=(hd{X},gpt{X})\ngrub> linux /boot/vmlinuz〈...tab here!...〉.efi.signed root=UUID=〈the UUID〉\ngrub> initrd /boot/initrd〈...tab here!...〉\ngrub> boot\n```\n\nThis should boot your **Full Kali Installation** using the Live GRUB. You could differentiate from the Live environment by the password it recognizes during the login process.\n\n### Fixing the EFI partition\n\nOnce you’re logged in in your Kali installation, open the Terminal and type:\n\n```bash\nfdisk -l\n```\n\nand find your drive.\n\nNow, open **gdisk** (installed by default on Kali) to partition the drive (be very careful here):\n\n```bash\n$ gdisk /dev/sd{X}\nGPT fdisk (gdisk) version 1.0.1\n\nPartition table scan:\n  MBR: hybrid\n  BSD: not present\n  APM: not present\n  GPT: present\n\nFound valid GPT with hybrid MBR; using GPT.\n\nCommand (? for help):\n```\n\nNow we have to:\n\n* delete that EF00 partition\n\n* create a new HFS+ once in its place\n\n```bash\nCommand (? for help): p\nDisk /dev/sdd: ...\n\n[...]\n\nNumber  Start (sector)  End (sector)  Size     Code   Name\n   1         2048         1050623  512.0 MiB   EF00   EFI System Partition\n\n[...]\n```\n*Just leave defaults values in the sector phase*\n\n```bash\nCurrent type is 'Linux filesystem'\nHex code or GUID (L to show codes, Enter = 8300): AF00\nChanged type of partition to 'Apple HFS/HFS+'\n\nCommand (? for help): w\n\nFinal checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING PARTITIONS!!\n\nDo you want to proceed? (Y/N): Y\n\nOK; writing new GUID partition table (GPT) to /dev/sdd.\nWarning: The kernel is still using the old partition table.\nThe new table will be used at the next reboot.\nThe operation has completed successfully.\n```\n\nNow we have an unformatted HFS+ partition. To format, we need some tools; but to obtain these tools we need to add the Debian source-list to **apt**.\n\n```bash\necho \"deb http://ftp.debian.org/debian unstable main contrib non-free\" > /etc/apt/sources.list.d/debian.list && \\\napt update && \\\napt install hfsprogs\n```\n\nWe can format that partition:\n\n```bash\nmkfs.hfsplus /dev/sd{X}1 -v Kali\n```\n\nNow we have to edit the **/etc/fstab** file:\n\n```bash\ngedit /etc/fstab\n```\n\nThis will launch Gedit. In this file, localize these lines:\n\n```\n# /boot/efi was on /dev/sd{X}1 during installation\nUUID={XXXXXXX} /boot/efi vfat defaults 0 1\n```\n\nand delete them.\n\nNow, unmount the boot partition, localizing it using:\n\n```bash\nmount | grep /boot/efi\numount /dev/sd{Y}1\n```\n\nThen run this to add the necessary entries to your fstab file:\n\n```bash\necho \"UUID=$(blkid -o value -s UUID /dev/sd{X}1) /boot/efi auto defaults 0 0\" >> /etc/fstab\n```\n\nNow we have to reinstall GRUB so it can use the newly formatted HFS+ partition for its EFI data:\n\n```bash\nmkdir -p /boot/efi/EFI/Kali\necho \"This file is required for booting\" > /boot/efi/EFI/Kali/mach_kernel\necho \"This file is required for booting\" > /boot/efi/mach_kernel\ngrub-install --target x86_64-efi --boot-directory=/boot --efi-directory=/boot/efi --bootloader-id=Kali\n```\n\nWe then need to “bless” the bootloader code, so that the Mac bootloader will boot it. To do that we need **hfsbless** binary that is not available via apt. No problem, just clone the repository and build:\n\n```bash\ncd /root\ngit clone https://github.com/detly/mactel-boot\ncd mactel-boot\nmake\n```\n\nThen bless:\n\n```bash\n./hfs-bless /boot/efi/EFI/Kali/System/Library/CoreServices/boot.efi\n```\n\nThe final step is to create the grub configuration:\n\n```bash\nsed -i 's/GRUB_HIDDEN/#GRUB_HIDDEN/g' /etc/default/grub\nsed -i 's/GRUB_TIMEOUT=10/GRUB_TIMEOUT=0.1/' /etc/default/grub\ngrub-mkconfig -o /boot/grub/grub.cfg\n```\n\nPerfecto! Now reboot and you should see your USB stick in the Mac bootloader by pressing **ALT**.\n\n### Virtualizing the USB via Virtualbox\n\nIf you ever need to boot this USB stick via Virtualbox (on Mac OSX), there is a simple trick to do that.\n\nFirst of all, you’ve to create a VMDK disk that points to the sectors of your USB stick. So, let’s identify that disk:\n\n```\ndiskutil list\n    /dev/disk0 (internal):\n       #:                       TYPE NAME                    SIZE       IDENTIFIER\n       0:      GUID_partition_scheme                         500.3 GB   disk0\n       1:                        EFI EFI                     314.6 MB   disk0s1\n       2:                 Apple_APFS Container disk1         499.3 GB   disk0s2\n\n    /dev/disk1 (synthesized):\n       #:                       TYPE NAME                    SIZE       IDENTIFIER\n       0:      APFS Container Scheme -                      +499.3 GB   disk1\n                                     Physical Store disk0s2\n       1:                APFS Volume Macintosh HD            222.0 GB   disk1s1\n       2:                APFS Volume Preboot                 22.4 MB    disk1s2\n       3:                APFS Volume Recovery                519.9 MB   disk1s3\n       4:                APFS Volume VM                      3.2 GB     disk1s4\n\n    /dev/disk3 (external, physical):\n       #:                       TYPE NAME                    SIZE       IDENTIFIER\n       0:      GUID_partition_scheme                        *32.0 GB    disk3\n```\n\nIn our case, it is **/dev/disk3. **Let’s unmount before proceeding:\n\n```bash\ndiskutil unmountDisk /dev/disk{X}\n```\n\nWith VirtualBox installed, run:\n\n```bash\nsudo VBoxManage internalcommands createrawvmdk -filename ~/Kali.vmdk -rawdisk /dev/disk{X}\nchmod 777 ~/Kali.vmdk\nchmod 777 /dev/disk{X}\n```\n\nPerfecto. Now, run Virtualbox UI and create a new machine with the following settings:\n\n![](https://cdn-images-1.medium.com/max/2000/1*oyWrYb9bcCPJfNRUyloKQQ.png)\n\nWhen VirtualBox asks you for a disk, let’s point to that VMDK created before:\n\n![](https://cdn-images-1.medium.com/max/2000/1*3FNitD5paeNC683Yxty4WQ.png)\n\nBefore starting up the machine, let’s go to Settings and adjust your process counts, video and memory.\n\nThe important things are to set **Enable EFI **under **System > Motherboard.**\n\n![](https://cdn-images-1.medium.com/max/2000/1*_fyYoNFb9tzyeDZqHOS0gQ.png)\n\nThis will allow you to boot via EFI. Now start the virtual machine and immediately press **F12**.\n\nSelect **Boot Maintenance Manager:**\n\n![](https://cdn-images-1.medium.com/max/2000/1*_Qyi-uKl68zNQFBSVrfrlQ.png)\n\nSelect **Boot from file:**\n\n![](https://cdn-images-1.medium.com/max/2000/1*lu734xFjlJa0UgXWg9oIAw.png)\n\nThen select {**SATA_DRIVE} > EFI > Kali > System > Library > CoreServices > boot.efi**\n\n![](https://cdn-images-1.medium.com/max/2000/1*XhEFqkrLQdKh8LnnHHmD2A.png)\n\nAnd, voilà:\n\n![](https://cdn-images-1.medium.com/max/2048/1*ct2UMeotA-Sbvyhka9T4pw.png)\n\nStay tuned :)\n",
  "user": {
    "name": "Flavio De Stefano",
    "username": "kopiro",
    "twitter_username": "destefanoflavio",
    "github_username": "kopiro",
    "user_id": 386888,
    "website_url": "https://www.kopiro.me",
    "profile_image": "https://media2.dev.to/dynamic/image/width=640,height=640,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Fuser%2Fprofile_image%2F386888%2Ff683c0ad-bdf7-4401-9141-46416239d66d.jpg",
    "profile_image_90": "https://media2.dev.to/dynamic/image/width=90,height=90,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Fuser%2Fprofile_image%2F386888%2Ff683c0ad-bdf7-4401-9141-46416239d66d.jpg"
  }
}